<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Socket.IO Game Room Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  </head>
  <body>
    <h1>Socket.IO Game Room Test</h1>

    <div style="margin-bottom: 8px">
      <label
        >Token:
        <input
          type="text"
          id="token"
          value="INVALID_TOKEN"
          style="width: 420px"
        />
      </label>
      <button id="connectBtn">Connect</button>
      <button id="disconnectBtn">Disconnect</button>
    </div>

    <div style="margin-bottom: 8px">
      <button id="createBtn">Create Room (game_room.create)</button>
    </div>

    <div style="margin-bottom: 8px">
      <label
        >Room ID:
        <input
          type="text"
          id="roomId"
          placeholder="e.g. 12345"
          style="width: 200px"
        />
      </label>
      <button id="joinBtn">Join Room (game_room.subscribe)</button>
      <button id="leaveBtn">Leave Room (game_room.leave)</button>
    </div>

    <pre
      id="log"
      style="background: #eee; padding: 10px; height: 340px; overflow: auto"
    ></pre>

    <script>
      let socket;

      function log(...args) {
        const pre = document.getElementById('log');
        pre.textContent +=
          args
            .map((a) => (typeof a === 'string' ? a : JSON.stringify(a)))
            .join(' ') + '\n';
        pre.scrollTop = pre.scrollHeight;
      }

      function getRoomId() {
        return document.getElementById('roomId').value?.trim();
      }

      // Connect
      document.getElementById('connectBtn').addEventListener('click', () => {
        if (socket) {
          log('Already connected. Disconnect first.');
          return;
        }
        const token = document.getElementById('token').value;

        socket = io('http://localhost:3000', {
          auth: { token: `Bearer ${token}` },
          transports: ['websocket'],
        });

        socket.on('connect', () => log('[connect]', socket.id));
        socket.on('disconnect', (reason) => {
          log('[disconnect]', reason);
          socket = null;
        });
        socket.on('exception', (err) => log('[exception]', err));
        socket.on('connect_error', (err) =>
          log('[connect_error]', err.message),
        );

        // --- Game Room Events ---
        socket.on('game_room.created', (payload) => {
          log('[game_room.created]', payload);
        });
        socket.on('game_room.member_joined', (payload) => {
          log('[game_room.member_joined]', payload);
        });
        socket.on('game_room.member_left', (payload) => {
          log('[game_room.member_left]', payload);
        });
        socket.on('game_room.member_role_changed', (payload) => {
          log('[game_room.member_role_changed]', payload);
        });
        socket.on('game_room.closed', (payload) => {
          log('[game_room.closed]', payload);
        });
      });

      // Disconnect
      document.getElementById('disconnectBtn').addEventListener('click', () => {
        if (socket && socket.connected) {
          socket.disconnect();
        } else {
          log('Not connected.');
        }
      });

      // Create Room (game_room.create)
      document.getElementById('createBtn').addEventListener('click', () => {
        if (!socket || !socket.connected) return log('Socket is not connected');

        socket.emit('game_room.create', {}, (ack) => {
          log('[game_room.create ack]', ack);
        });
      });

      // Join Room (game_room.subscribe)
      document.getElementById('joinBtn').addEventListener('click', () => {
        if (!socket || !socket.connected) return log('Socket is not connected');

        const roomId = getRoomId();
        if (!roomId) return log('roomId is empty');

        socket.emit('game_room.subscribe', { roomId }, (ack) => {
          log('[game_room.subscribe ack]', ack);
        });
      });

      // Leave Room (game_room.leave)
      document.getElementById('leaveBtn').addEventListener('click', () => {
        if (!socket || !socket.connected) return log('Socket is not connected');

        const roomId = getRoomId();
        if (!roomId) return log('roomId is empty');

        socket.emit('game_room.leave', { roomId }, (ack) => {
          log('[game_room.leave ack]', ack);
        });
      });
    </script>
  </body>
</html>
